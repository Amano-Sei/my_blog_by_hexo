---
title: 检查了下代码
cwd: hexo/myblog
date: 2020-09-25 21:17:06
tags:
- 日常
- csapp
---

刚刚完成了代码的检查。

同时对火狐打开情况进行了预测，都完全符合预期。

现在猜测是chrome会限制对同一个ip同时打开的连接数，究竟怎么回事可能药看chrome代码才知道了。

然后是现在的问题，因为我对缓冲区的检查是在insert和remove的时候进行的，并且如果缓冲区清空后，要关闭的线程如果连接还没有关闭就只能一直等着。

导致的结果就是我只能同时放两倍的起始线程数的（缓冲区和起始线程数一样大）masterpiece...

然后mutex信号量就会一直握在减少线程的线程手里直到他想关的线程的服务结束了然后关掉他想关的线程为止都不可能再进行新的服务或者扩大线程...

现在觉得可能还是额外的定期检查比较好，在上面加一个额外的entry信号量来避免饥饿。而且现在来看信号量并不复杂...说人家写的莫名其妙是我的理解不到位...

突然意识到...我的理解有锅...

