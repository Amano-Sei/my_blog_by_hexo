---
title: 和之前一样先来整理下关于cache部分的思路
cwd: hexo/myblog
date: 2020-09-29 18:48:06
tags:
- csapp
- 日常
---

说实话，自己可能是在不想和csapp说再见，所以昨天才玩了原神，今天也整体效率不高。但是总归是要说再见的嘛，而且都这么久了。

言归正传，基本上第一二部分是重写了PP，并且修改过后相比于pp有更好的结构。接下来整理完思路后会做下整体检查，然后就着手cache部分的实现。

我个人来说不是很想搞个连续的块然后在需要换出一些块时还要顺序遍历整个缓存。

我个人想实现的是我们保存的是一个个缓存管理块的链表，然后在每次读后把它放到队尾，在缓存大小要超过最大限制时，依次释放队首的块，直到足够我们放下新的缓存。

首先这是典型的读者写者问题，我想实现成写优先的形式。因为每一个连接都首先是读者，然后在检查过想要的内容没有缓存后才会有可能变成写者，所以读者的频率要远大于写者。而写者写的内容很有可能会是接下来的读者想要读的内容，所以写需要有一定的优先级。需要注意的是，即使这样也有可能会出现重复获取同一连接的内容，所以在写的时候需要再次检查是否不需要缓存。

信号量同步方面除了整个缓存外，还需要给链表加个互斥信号量，本来是想针对节点加的，但是事实上所有节点都需要修改头部节点，所以其实还是个互斥...

对于缓存的检索，准备用hash表来实现，hash值由url得来，本来这里能唯一标识缓存的就是url。

嘛，差不多就这样吧，明天之内应该是可以搞定的。如果今天没有野鸡大学莫名其妙开会的话说不定今天就可以（

