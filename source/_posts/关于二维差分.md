---
title: 关于二维差分
cwd: hexo/myblog
date: 2020-10-26 15:34:36
mathjax: true
tags:
- 差分
- 思考
---

本来是打算写个博客搞这个的，但是想了想没必要，就在这里写点自己的理解吧。

我看到的有个博客中说的特别好，差分数组的前缀和是原数组，前缀和的差分数组也是原数组，两者就好像逆运算一样。

常见的二维差分往往会写成$diff\[i\]\[j\]=a\[i\]\[j\]\+a\[i\-1\]\[j\-1\]\-a\[i\-1\]\[j\]\-a\[i\]\[j\-1\]$，其实加上括号会更好理解一点。
$$
diff\[i\]\[j\]=\(a\[i\]\[j\]\-a\[i\]\[j\-1\]\)\-\(a\[i\-1\]\[j\]\-a\[i\-1\]\[j\-1\]\)
$$
我们完全可以理解成二维的差分就是差的差，在明白了这一点之后一切曾经的问题都不再是问题了...

然后差的差的和会变成差，而且这两种差是可以交换的，我们只需要修改式子内括号括住的对象即可。（虽然听起来挺绕的，嘛反正我自己能看懂，而且现在理解了以后可能也不需要回来看了。）

然后考虑前缀和的前缀和，我们只需要关注每个差的差在多少个矩形中出现即可。得到$\sum \(n\+1\-i\)\*\(m\+1\-j\)\*diff\[i\]\[j\]$，然后根据这个就可以去维护四个树状数组，然后就可以求任意区域和。

关于区间修改，思考修改一片区域后，差的差会发生改变的都有那些点，然后修改那四个点即可。

后续我还想了下三维的情况，我现在的空间想象能力明显不如小时候了（只用前面的前缀和和当前点值求当前点的前缀和可以用7个前缀和。而差的差的差和二维中一样两次$\-1$的是加，其他都是减。

我在过去对树状数组的理解中有一个极大的误区，就是树状数组有log级别的修改区间的能力。其实这句话一定要说的话不能算错，但是其实是这样的。差分数组使得可以在常数时间内修改区间，通过树状数组维护一些特定的前缀和，可以在log的时间内查询任意区间的和。是的，树状数组只是动态维护更新前缀和的log级的方式罢了。

所以树状数组的博客鸽了$\leftarrow$你只是在找借口...

等下看两眼生成树计数就去搞考研的东西...

